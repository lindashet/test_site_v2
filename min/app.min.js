var galleryData,
  articleData,
  infoData,
  isHamburgerMenuOpened = !1,
  galleryCount = 0,
  articleCount = 0,
  gallery_item_html =
    "<div class='work_item_container' id ='{{id}}'><div class='work_item_bg work_item_bg_{{num}}' style='background-image: url({{imgUrl}})'><div class='work_item_bg_cover'></div><div class='work_item_text'><h5>{{name}}</h5><p>{{content}}</p></div></div><div class='work_title'><h5>{{name}}</h5>{{tags}}</div>",
  smScreen = window.matchMedia("(max-width: 992px)"),
  lgScreen = window.matchMedia("(min-width: 992px)"),
  mdMinScreen = window.matchMedia("(max-width: 767px)"),
  mdMaxScreen = window.matchMedia("(min-width: 768px)"),
  indexDomain = "",
  serverDomain = "https://icarry-webserver.intelligentcarry.com/api/v1/",
  imageDomain = "https://icarry-webserver.intelligentcarry.com/",
  collectionsUrl = "collections",
  infoUrl = "company_informations",
  subscriptionpUrl = "subscriptions",
  contactsUrl = "contacts",
  articlesUrl = "articles";
function callSubscribtionApi(e) {
  $.ajax({
    url: serverDomain + subscriptionpUrl,
    type: "POST",
    data: JSON.stringify(e),
    contentType: "application/json; charset=utf-8",
    success: function (e) {
      alert("訂閱成功！");
    },
    error: function () {
      alert("訂閱失敗！");
    },
  });
}
function callContactApi(e) {
  $.ajax({
    url: serverDomain + contactsUrl,
    type: "POST",
    data: JSON.stringify(e),
    contentType: "application/json; charset=utf-8",
    success: function (e) {
      $("#contact_phone").val(""),
        $("#contact_email").val(""),
        $("#contact_content").val(""),
        alert("發送成功！");
    },
    error: function () {
      alert("發送失敗！");
    },
  });
}
function showGalleryList() {
  let e = galleryData.collections.length;
  for (var t = 0; t < e; t++) {
    for (
      var a = galleryData.collections[t],
        n = "gallery_item_" + galleryData.collections[t].id,
        i = a.sub_categories,
        r = "",
        o = 0;
      o < i.length;
      o++
    ) {
      r = r + "<h6 class='tag'>" + i[o].title + "</h6>";
    }
    var l = gallery_item_html
      .replace("{{id}}", n)
      .replace("{{num}}", t + 1)
      .replace("{{pageTag}}", indexDomain + "#" + n)
      .replace("{{imgUrl}}", imageDomain + a.image)
      .replace(/{{name}}/g, a.title)
      .replace(/{{content}}/g, a.subtitle)
      .replace("{{tags}}", r);
    $("#gallery_html").append(l);
  }
  $("#gallery_html").append("<div class='work_item_end'></div>");
}
function showArticleList() {
  let e = articleData.articles;
  switch (
    ($(".article_item.third").css("display", "none"),
    $(".article_img.third").css("display", "none"),
    $(".article_item.second").css("display", "none"),
    $(".article_img.second").css("display", "none"),
    $(".article_item.first").css("display", "none"),
    $(".article_img.first").css("display", "none"),
    e.length)
  ) {
    case 3:
      $(".article_img.third").css(
        "background-image",
        "url(" + imageDomain + e[2].image + ")"
      ),
        $(".article_item.third h5").text(e[2].title),
        $(".article_item.third p").text(e[2].subtitle),
        $(".article_item.third a").attr("href", e[1].url),
        $(".article_item.third").css("display", "block"),
        $(".article_img.third").css("display", "block"),
        $(".article_img.third").attr("href", e[2].url);
    case 2:
      $(".article_img.second").css(
        "background-image",
        "url(" + imageDomain + e[1].image + ")"
      ),
        $(".article_item.second h5").text(e[1].title),
        $(".article_item.second p").text(e[1].subtitle),
        $(".article_item.second a").attr("href", e[1].url),
        $(".article_item.second").css("display", "block"),
        $(".article_img.second").css("display", "block"),
        $(".article_img.second").attr("href", e[1].url);
    case 1:
      $(".article_img.first").css(
        "background-image",
        "url(" + imageDomain + e[0].image + ")"
      ),
        $(".article_item.first h5").text(e[0].title),
        $(".article_item.first p").text(e[0].subtitle),
        $(".article_item.first a").attr("href", e[0].url),
        $(".article_item.first").css("display", "block"),
        $(".article_img.first").css("display", "block"),
        $(".article_img.first").attr("href", e[0].url);
  }
}
function showInfo() {
  var e = infoData;
  $(".company_info .tel").text(e.telephone),
    $(".company_info .email").text(e.email),
    $(".company_info .company_name").text(e.name),
    $(".company_info .company_en_name").text(e.english_name),
    $(".company_info .company_address").text(e.address);
}
function setTagLinkVisibility(e, t) {
  0 == e
    ? ($(t).addClass("hide"), $(t).addClass("hide"))
    : $(t).removeClass("hide");
}
function smScreenUpdateView(e) {
  e.matches && shrinkAsideBlock();
}
function lgScreenUpdateView(e) {
  e.matches &&
    (expandAsideBlock(), $(".root_container").removeClass("black_cover"));
}
function mdMinScreenUpdateView(e) {
  e.matches &&
    ($(".navbar-nav").addClass("hidden"),
    $("#hamburger_btn").removeClass("hamburger_btn_open"),
    (isHamburgerMenuOpened = !1));
}
function mdMaxScreenUpdateView(e) {
  e.matches &&
    ($(".hamburger_middle").removeClass("hamburger_middle_open"),
    $(".hamburger_top").removeClass("hamburger_top_open"),
    $(".hamburger_bottom").removeClass("hamburger_bottom_open"),
    $("#hamburger_btn").removeClass("hamburger_btn_open"),
    $(".nav_menu").css("display", "none"),
    $("nav").removeClass("nav_toggle"),
    (isHamburgerMenuOpened = !0));
}
$.ajax({
  type: "GET",
  url: serverDomain + collectionsUrl,
  success: function (e) {
    (galleryCount = (galleryData = e).collections.length),
      initGalleryList(),
      smScreen.matches && shrinkAsideBlock(),
      lgScreen.matches && expandAsideBlock();
  },
}),
  $.ajax({
    type: "GET",
    url: serverDomain + articlesUrl,
    success: function (e) {
      (articleData = e), showArticleList();
    },
  }),
  $.ajax({
    type: "GET",
    url: serverDomain + infoUrl,
    success: function (e) {
      (infoData = e), showInfo();
    },
  }),
  $(".back_home_btn").click(function () {
    closeMenu();
  }),
  $(".about_btn").click(function () {
    closeMenu();
  }),
  $(".contact_btn").click(function () {
    closeMenu();
  }),
  $("html").on("touchstart", function () {
    $("html").addClass("can_touch"), $("html").off("touchstart");
  });
var page = 0;
let totalPage = 6;
$(".view_container").click(function () {
  (page += 1) > totalPage - 1 && (page = 0),
    $(".flows").css("left", "-" + 100 * page + "%"),
    setProjectNavbarSelectedStatus();
});
for (var i = 0; i < totalPage; i++) {
  setClickListener(".tab_" + (i + 1), i);
}
function setClickListener(e, t) {
  $(e).click(function () {
    $(".flows").css("left", "-" + 100 * t + "%"),
      (page = t),
      setProjectNavbarSelectedStatus(),
      galleryBottom.slideTo(page, 700, !0);
  });
}
function removeCssClass(e, t) {
  $(e).removeClass(t);
}
function setProjectNavbarSelectedStatus() {
  for (let e = 0; e < totalPage; e++)
    e == page
      ? $(".tab_" + (e + 1)).addClass("selected_tab")
      : removeCssClass(".tab_" + (e + 1), "selected_tab");
}
function checkDialogOpening() {
  indexDomain = window.location.pathname;
  let e = location.hash.indexOf("#gallery_item");
  if (0 != location.hash.length && 0 == e) {
    let e = location.hash.replace("#gallery_item_", "");
    $("#dialog").removeClass("hide"),
      $(".dailog_bg").removeClass("hide"),
      $("body").css("overflow-y", "hidden"),
      getCollectionDetail(e);
  }
}
function initGalleryList() {
  $("#gallery_html").html(""), showGalleryList();
}
function shrinkAsideBlock() {
  $(".work_btn").removeClass("work_btn_zoom_in"),
    $("aside").addClass("side_container_shrink"),
    $(".root_container").removeClass("root_container_shrink"),
    $(".work_btn").addClass("work_btn_zoom_out"),
    $(".root_container").removeClass("black_cover");
}
function expandAsideBlock() {
  $(".work_btn").addClass("work_btn_zoom_in"),
    $(".root_container").addClass("root_container_shrink"),
    $("aside").removeClass("side_container_shrink");
}
function slideWorkContainer() {
  $(".work_item_end").velocity("scroll", {
    container: $(".work_container"),
    duration: 5e3,
  });
}
function closeMenu() {
  $(".hamburger_middle").removeClass("hamburger_middle_open"),
    $(".hamburger_top").removeClass("hamburger_top_open"),
    $(".hamburger_bottom").removeClass("hamburger_bottom_open"),
    $("#hamburger_btn").removeClass("hamburger_btn_open"),
    $(".nav_menu").css("display", "none"),
    $("nav").removeClass("nav_toggle");
}
function openMenu() {
  $(".hamburger_middle").addClass("hamburger_middle_open"),
    $(".hamburger_top").addClass("hamburger_top_open"),
    $(".hamburger_bottom").addClass("hamburger_bottom_open"),
    $("#hamburger_btn").addClass("hamburger_btn_open"),
    $(".nav_menu").css("display", "block"),
    $("nav").addClass("nav_toggle");
}
$(window).scroll(function (e) {
  $(window).scrollTop() > 0
    ? ($(".back_to_top").removeClass("transparent"),
      $(".about").removeClass("footer-dark"),
      $(".navbar").removeClass("navbar-top"),
      $(".icarry_title").addClass("icarry_title_transfer"))
    : ($(".navbar").addClass("navbar-top"),
      $(".back_to_top").addClass("transparent"),
      $(".icarry_title").removeClass("icarry_title_transfer"));
}),
  ($body = window.opera
    ? "CSS1Compat" == document.compatMode
      ? $("html")
      : $("body")
    : $("html,body")),
  $(".back_to_top").click(function () {
    $("html, body").animate({ scrollTop: 0 }, 1e3);
  }),
  smScreen.addListener(smScreenUpdateView),
  lgScreen.addListener(lgScreenUpdateView),
  mdMinScreen.addListener(mdMinScreenUpdateView),
  mdMaxScreen.addListener(mdMaxScreenUpdateView),
  $(".shrink_btn").click(function () {
    shrinkAsideBlock();
  }),
  $(".work_btn").click(function () {
    expandAsideBlock(),
      smScreen.matches && $(".root_container").addClass("black_cover");
  }),
  $(".work_down_btn").hover(
    function () {
      $(".work_down_btn .rect").css("background-color", "#C5ABEC"),
        slideWorkContainer();
    },
    function () {
      $(".work_down_btn .rect").css("background-color", "#9664E2"),
        $(".work_item_end").velocity("stop");
    }
  ),
  $("aside").hover(
    function () {
      $(".work_down_btn .arrow_bottom").css("display", "block");
    },
    function () {
      $(".work_down_btn .arrow_bottom").css("display", "none");
    }
  ),
  $("#follow_btn").click(function () {
    var e = $("#sub_email").val();
    if (e.length > 0) {
      if (
        null == e.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$")
      )
        alert("請填寫正確Email格式");
      else callSubscribtionApi({ email: e });
    } else alert("請填寫Email");
  }),
  $("#contact_send_btn").click(function () {
    var e = {
      name: $("#contact_name").val(),
      telephone: $("#contact_phone").val(),
      email: $("#contact_email").val(),
      content: $("#contact_content").val(),
    };
    if (
      0 == e.name.length ||
      0 == e.telephone.length ||
      0 == e.email.length ||
      0 == e.content.length
    )
      alert("請填寫您的聯絡資訊與訊息內容");
    else {
      var t = "^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$";
      if (null == e.email.match(t)) return void alert("請填寫正確Email格式");
      if (((t = "^(09)\\d{8}$"), null == e.telephone.match(t)))
        return void alert("請填寫正確手機號碼格式");
      callContactApi(e);
    }
  }),
  $("#hamburger_btn").click(function () {
    isHamburgerMenuOpened ? closeMenu() : openMenu(),
      (isHamburgerMenuOpened = !isHamburgerMenuOpened);
  });
